<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ordina Ora - La Perla di Sicilia</title>
    <meta name="description" content="Ordina i nostri autentici fichi d'India siciliani. Form di contatto per ordini personalizzati." />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        terracotta: '#9C3D2B',
                        olive: '#6B8E23',
                        sunset: '#E2725B',
                        gold: '#D4A017',
                        cactus: '#446A46',
                        parchment: '#F8F4E9',
                        sicilian: {
                            red: '#C8102E',
                            gold: '#FFD700',
                            orange: '#FF8C00'
                        }
                    },
                    fontFamily: {
                        'playfair': ['Playfair Display', 'serif'],
                        'roboto': ['Roboto', 'sans-serif'],
                        'dancing': ['Dancing Script', 'cursive'],
                        'lora': ['Lora', 'serif'],
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'shimmer': 'shimmer 2s linear infinite',
                        'bounce-slow': 'bounce 3s infinite',
                        'slide-in': 'slideIn 0.5s ease-out',
                        'fade-in': 'fadeIn 0.6s ease-out',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-20px)' }
                        },
                        shimmer: {
                            '0%': { transform: 'translateX(-100%)', opacity: '0' },
                            '50%': { opacity: '1' },
                            '100%': { transform: 'translateX(100%)', opacity: '0' }
                        },
                        slideIn: {
                            '0%': { transform: 'translateX(-50px)', opacity: '0' },
                            '100%': { transform: 'translateX(0)', opacity: '1' }
                        },
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Roboto:wght@300;400;500&family=Dancing+Script:wght@700&family=Lora:wght@400;700&display=swap" rel="stylesheet" />
    <style>
        body {
            font-family: 'Lora', serif;
            background: linear-gradient(135deg, #F8F4E9 0%, #E8E0D1 100%);
            color: #333;
            scroll-behavior: smooth;
            overflow-x: hidden;
        }
        
        .handwritten {
            font-family: 'Dancing Script', cursive;
        }
        
        .heading {
            font-family: 'Playfair Display', serif;
        }
        
        .body-text {
            font-family: 'Lora', serif;
        }

        .hero-pattern {
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(212, 160, 23, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(156, 61, 43, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(68, 106, 70, 0.1) 0%, transparent 50%);
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .form-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 25px 50px rgba(0,0,0,0.1);
        }

        .input-group {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .form-input {
            width: 100%;
            padding: 1rem 1.5rem;
            border: 2px solid #e5e7eb;
            border-radius: 1rem;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
            font-family: 'Lora', serif;
        }

        .form-input:focus {
            outline: none;
            border-color: #D4A017;
            box-shadow: 0 0 20px rgba(212, 160, 23, 0.2);
            background: white;
        }

        .form-label {
            position: absolute;
            left: 1.5rem;
            top: 1rem;
            color: #6b7280;
            font-size: 1rem;
            transition: all 0.3s ease;
            pointer-events: none;
            background: transparent;
            font-weight: 500;
        }

        .form-input:focus + .form-label,
        .form-input:not(:placeholder-shown) + .form-label {
            top: -0.5rem;
            left: 1rem;
            font-size: 0.875rem;
            color: #D4A017;
            background: white;
            padding: 0 0.5rem;
            font-weight: 600;
        }

        .btn-premium {
            background: linear-gradient(135deg, #9C3D2B, #D4A017);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(156, 61, 43, 0.3);
        }

        .btn-premium:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(156, 61, 43, 0.4);
        }

        .btn-premium::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: all 0.5s;
        }

        .btn-premium:hover::after {
            left: 100%;
        }

        .floating-element {
            animation: float 6s ease-in-out infinite;
        }

        .text-gradient {
            background: linear-gradient(135deg, #9C3D2B, #D4A017, #E2725B);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .section-divider {
            background: linear-gradient(90deg, transparent, #D4A017, transparent);
            height: 2px;
            width: 100px;
            margin: 0 auto;
        }

        .quantity-selector {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #e5e7eb;
            border-radius: 1rem;
            padding: 0.5rem;
            transition: all 0.3s ease;
        }

        .quantity-selector:focus-within {
            border-color: #D4A017;
            box-shadow: 0 0 20px rgba(212, 160, 23, 0.2);
        }

        .quantity-btn {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            background: linear-gradient(135deg, #9C3D2B, #D4A017);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .quantity-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(156, 61, 43, 0.3);
        }

        .quantity-display {
            font-size: 1.2rem;
            font-weight: bold;
            color: #9C3D2B;
            min-width: 3rem;
            text-align: center;
        }

        .product-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .product-card {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #e5e7eb;
            border-radius: 1rem;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .product-card:hover {
            border-color: #D4A017;
            box-shadow: 0 10px 30px rgba(212, 160, 23, 0.2);
            transform: translateY(-5px);
        }

        .product-card.selected {
            border-color: #9C3D2B;
            background: rgba(156, 61, 43, 0.05);
            box-shadow: 0 10px 30px rgba(156, 61, 43, 0.2);
        }

        .product-card.selected::before {
            content: '✓';
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 2rem;
            height: 2rem;
            background: linear-gradient(135deg, #9C3D2B, #D4A017);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .order-summary {
            background: linear-gradient(135deg, rgba(156, 61, 43, 0.1), rgba(212, 160, 23, 0.1));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(212, 160, 23, 0.3);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .success-message {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 1.5rem;
            border-radius: 1rem;
            text-align: center;
            display: none;
            animation: fadeIn 0.6s ease-out;
        }

        @media (max-width: 768px) {
            .product-selection {
                grid-template-columns: 1fr;
            }
        }

        .modal-overlay {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body class="relative hero-pattern">
    <!-- Animated Background Elements -->
    <div class="fixed inset-0 pointer-events-none z-0">
        <div class="floating-element absolute top-20 left-10 w-4 h-4 bg-gold rounded-full opacity-30"></div>
        <div class="floating-element absolute top-40 right-20 w-6 h-6 bg-sunset rounded-full opacity-20" style="animation-delay: -2s;"></div>
        <div class="floating-element absolute bottom-32 left-1/4 w-3 h-3 bg-terracotta rounded-full opacity-25" style="animation-delay: -4s;"></div>
        <div class="floating-element absolute bottom-20 right-1/3 w-5 h-5 bg-cactus rounded-full opacity-30" style="animation-delay: -1s;"></div>
    </div>

    <!-- Header -->
    <header class="fixed top-0 left-0 right-0 glass-effect shadow-lg z-30 w-full">
        <div class="container mx-auto px-4 sm:px-8 py-4 flex justify-between items-center">
            <a href="products.html" class="flex items-center space-x-4">
                <img src="imgs/logo.png" alt="La Perla di Sicilia Logo" class="w-14 h-14 md:w-16 md:h-16 rounded-full shadow-lg object-contain" />
                <div>
                    <h1 class="heading text-2xl md:text-3xl text-gradient font-bold">La Perla di Sicilia</h1>
                    <p class="handwritten text-xs md:text-sm text-terracotta opacity-75">Autentici Fichi d'India</p>
                </div>
            </a>
            <button onclick="goBack()" class="glass-effect px-6 py-3 rounded-full text-terracotta hover:text-gold transition duration-300">
                <i class="fas fa-arrow-left mr-2"></i>Torna ai Prodotti
            </button>
        </div>
    </header>

    <!-- Order Form Section -->
    <section class="pt-32 pb-20 relative">
        <div class="container mx-auto px-6 max-w-4xl">
            <div class="text-center mb-12 animate-fade-in">
                <h1 class="heading text-5xl md:text-6xl text-gradient mb-6 font-black">
                    Ordina i Tuoi Fichi d'India
                </h1>
                <div class="section-divider mb-6"></div>
                <p class="text-xl text-gray-700 body-text leading-relaxed">
                    Compila il form per ricevere i nostri autentici fichi d'India siciliani direttamente a casa tua
                </p>
            </div>

            <div class="form-container rounded-3xl p-8 md:p-12 animate-slide-in">
                <!-- Success Message -->
                <div id="successMessage" class="success-message mb-8">
                    <i class="fas fa-check-circle text-3xl mb-4"></i>
                    <h3 class="text-2xl font-bold mb-2">Ordine Ricevuto!</h3>
                    <p>Grazie per il tuo ordine. Ti contatteremo entro 24 ore per confermare i dettagli.</p>
                </div>

                <form id="orderForm">
                    <!-- Product Selection -->
                    <div class="mb-8">
                        <h3 class="heading text-2xl text-terracotta mb-6 font-bold">
                            <i class="fas fa-apple-alt mr-3"></i>Seleziona i Prodotti
                        </h3>
                        <div class="product-selection">
                            <div class="product-card" data-product="giallo" data-price="9.90">
                                <div class="flex items-center mb-4">
                                    <img src="imgs/giallo.png" alt="Fico d'India Giallo" class="w-16 h-16 rounded-full mr-4 object-cover" />
                                    <div>
                                        <h4 class="font-bold text-lg text-terracotta">Sulfarina (Giallo)</h4>
                                        <p class="text-sm text-gray-600">Dolce e mielato</p>
                                        <p class="text-lg font-bold text-gold">€9.90/kg</p>
                                    </div>
                                </div>
                                <div class="quantity-selector">
                                    <button type="button" class="quantity-btn" onclick="decreaseQuantity('giallo')">-</button>
                                    <span class="quantity-display" id="quantity-giallo">0</span>
                                    <button type="button" class="quantity-btn" onclick="increaseQuantity('giallo')">+</button>
                                </div>
                            </div>

                            <div class="product-card" data-product="rosso" data-price="12.90">
                                <div class="flex items-center mb-4">
                                    <img src="imgs/rosso.png" alt="Fico d'India Rosso" class="w-16 h-16 rounded-full mr-4 object-cover" />
                                    <div>
                                        <h4 class="font-bold text-lg text-terracotta">Sanguigno (Rosso)</h4>
                                        <p class="text-sm text-gray-600">Intenso e antiossidante</p>
                                        <p class="text-lg font-bold text-gold">€12.90/kg</p>
                                    </div>
                                </div>
                                <div class="quantity-selector">
                                    <button type="button" class="quantity-btn" onclick="decreaseQuantity('rosso')">-</button>
                                    <span class="quantity-display" id="quantity-rosso">0</span>
                                    <button type="button" class="quantity-btn" onclick="increaseQuantity('rosso')">+</button>
                                </div>
                            </div>

                            <div class="product-card" data-product="bianco" data-price="11.90">
                                <div class="flex items-center mb-4">
                                    <img src="imgs/verde.png" alt="Fico d'India Bianco" class="w-16 h-16 rounded-full mr-4 object-cover" />
                                    <div>
                                        <h4 class="font-bold text-lg text-terracotta">Muscaredda (Bianco)</h4>
                                        <p class="text-sm text-gray-600">Delicato e raffinato</p>
                                        <p class="text-lg font-bold text-gold">€11.90/kg</p>
                                    </div>
                                </div>
                                <div class="quantity-selector">
                                    <button type="button" class="quantity-btn" onclick="decreaseQuantity('bianco')">-</button>
                                    <span class="quantity-display" id="quantity-bianco">0</span>
                                    <button type="button" class="quantity-btn" onclick="increaseQuantity('bianco')">+</button>
                                </div>
                            </div>
                        </div>

                        <!-- Order Summary -->
                        <div id="orderSummary" class="order-summary" style="display: none;">
                            <h4 class="heading text-xl text-terracotta mb-4 font-bold">
                                <i class="fas fa-receipt mr-2"></i>Riepilogo Ordine
                            </h4>
                            <div id="summaryItems" class="space-y-2 mb-4"></div>
                            <div class="border-t pt-4">
                                <div class="flex justify-between items-center text-lg font-bold">
                                    <span>Totale:</span>
                                    <span id="totalPrice" class="text-gold text-2xl">€0.00</span>
                                </div>
                                <p class="text-sm text-gray-600 mt-2">
                                    <i class="fas fa-truck mr-1"></i>Spedizione gratuita per ordini superiori a €50
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Personal Information -->
                    <div class="mb-8">
                        <h3 class="heading text-2xl text-terracotta mb-6 font-bold">
                            <i class="fas fa-user mr-3"></i>Dati Personali
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="input-group">
                                <input type="text" id="nome" name="nome" class="form-input" placeholder=" " required>
                                <label for="nome" class="form-label">Nome *</label>
                            </div>
                            <div class="input-group">
                                <input type="text" id="cognome" name="cognome" class="form-input" placeholder=" " required>
                                <label for="cognome" class="form-label">Cognome *</label>
                            </div>
                            <div class="input-group">
                                <input type="email" id="email" name="email" class="form-input" placeholder=" " required>
                                <label for="email" class="form-label">Email *</label>
                            </div>
                            <div class="input-group">
                                <input type="tel" id="telefono" name="telefono" class="form-input" placeholder=" " required>
                                <label for="telefono" class="form-label">Telefono *</label>
                            </div>
                        </div>
                    </div>

                    <!-- Shipping Address -->
                    <div class="mb-8">
                        <h3 class="heading text-2xl text-terracotta mb-6 font-bold">
                            <i class="fas fa-map-marker-alt mr-3"></i>Indirizzo di Spedizione
                        </h3>
                        <div class="grid grid-cols-1 gap-6">
                            <div class="input-group">
                                <input type="text" id="indirizzo" name="indirizzo" class="form-input" placeholder=" " required>
                                <label for="indirizzo" class="form-label">Via e Numero Civico *</label>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="input-group">
                                    <input type="text" id="cap" name="cap" class="form-input" placeholder=" " required>
                                    <label for="cap" class="form-label">CAP *</label>
                                </div>
                                <div class="input-group">
                                    <input type="text" id="citta" name="citta" class="form-input" placeholder=" " required>
                                    <label for="citta" class="form-label">Città *</label>
                                </div>
                                <div class="input-group">
                                    <input type="text" id="provincia" name="provincia" class="form-input" placeholder=" " required>
                                    <label for="provincia" class="form-label">Provincia *</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Notes -->
                    <div class="mb-8">
                        <h3 class="heading text-2xl text-terracotta mb-6 font-bold">
                            <i class="fas fa-comment mr-3"></i>Note Aggiuntive
                        </h3>
                        <div class="input-group">
                            <textarea id="note" name="note" class="form-input min-h-[120px] resize-none" placeholder=" "></textarea>
                            <label for="note" class="form-label">Richieste speciali, preferenze di consegna...</label>
                        </div>
                    </div>

                    <!-- Terms and Submit -->
                    <div class="mb-8">
                        <label class="flex items-start space-x-3 cursor-pointer">
                            <input type="checkbox" id="privacy" name="privacy" class="mt-1 w-5 h-5 text-terracotta border-2 border-gray-300 rounded focus:ring-gold" required>
                            <span class="text-gray-700 text-sm leading-relaxed">
                                Accetto il trattamento dei dati personali secondo la 
                                <a href="#" class="text-terracotta hover:text-gold font-semibold">Privacy Policy</a> 
                                e acconsento ad essere contattato per la conferma dell'ordine. *
                            </span>
                        </label>
                    </div>

                    <div class="text-center">
                        <button type="submit" class="btn-premium text-white px-12 py-4 rounded-full text-lg font-bold transform hover:scale-105 transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed" id="submitBtn" disabled>
                            <i class="fas fa-paper-plane mr-3"></i>Invia Ordine
                        </button>
                        <p class="text-sm text-gray-600 mt-4">
                            Ti contatteremo entro 24 ore per confermare l'ordine e i dettagli di pagamento
                        </p>
                    </div>
                </form>
            </div>
        </div>
    </section>

    <script>
        // Product quantities
        let quantities = { giallo: 0, rosso: 0, bianco: 0 };
        let prices = { giallo: 9.90, rosso: 12.90, bianco: 11.90 };

        function increaseQuantity(product) {
            quantities[product]++;
            updateQuantityDisplay(product);
            updateProductCard(product);
            updateOrderSummary();
        }

        function decreaseQuantity(product) {
            if (quantities[product] > 0) {
                quantities[product]--;
                updateQuantityDisplay(product);
                updateProductCard(product);
                updateOrderSummary();
            }
        }

        function updateQuantityDisplay(product) {
            document.getElementById(`quantity-${product}`).textContent = quantities[product];
        }

        function updateProductCard(product) {
            const card = document.querySelector(`[data-product="${product}"]`);
            if (quantities[product] > 0) {
                card.classList.add('selected');
            } else {
                card.classList.remove('selected');
            }
        }

        function updateOrderSummary() {
            const summaryContainer = document.getElementById('orderSummary');
            const summaryItems = document.getElementById('summaryItems');
            const totalPriceElement = document.getElementById('totalPrice');
            
            let total = 0;
            let hasItems = false;
            let html = '';

            const productNames = {
                giallo: 'Sulfarina (Giallo)',
                rosso: 'Sanguigno (Rosso)',
                bianco: 'Muscaredda (Bianco)'
            };

            for (let product in quantities) {
                if (quantities[product] > 0) {
                    hasItems = true;
                    const subtotal = quantities[product] * prices[product];
                    total += subtotal;
                    html += `
                        <div class="flex justify-between items-center">
                            <span>${productNames[product]} x ${quantities[product]}kg</span>
                            <span class="font-semibold">€${subtotal.toFixed(2)}</span>
                        </div>
                    `;
                }
            }

            summaryItems.innerHTML = html;
            totalPriceElement.textContent = `€${total.toFixed(2)}`;
            
            if (hasItems) {
                summaryContainer.style.display = 'block';
                updateSubmitButton();
            } else {
                summaryContainer.style.display = 'none';
                updateSubmitButton();
            }
        }

        function updateSubmitButton() {
            const submitBtn = document.getElementById('submitBtn');
            const privacyCheck = document.getElementById('privacy');
            const hasProducts = Object.values(quantities).some(qty => qty > 0);
            
            if (hasProducts && privacyCheck.checked) {
                submitBtn.disabled = false;
                submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            } else {
                submitBtn.disabled = true;
                submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
            }
        }

        // Privacy checkbox listener
        document.getElementById('privacy').addEventListener('change', updateSubmitButton);

        // EmailJS configuration constants
        const EMAILJS_USER_ID = 'YOUR_EMAILJS_USER_ID'; // Replace with your EmailJS user ID
        const EMAILJS_SERVICE_ID = 'YOUR_SERVICE_ID'; // Replace with your EmailJS service ID
        const EMAILJS_TEMPLATE_ID = 'YOUR_TEMPLATE_ID'; // Replace with your EmailJS template ID

        // Load EmailJS SDK
        const emailjsScript = document.createElement('script');
        emailjsScript.src = 'https://cdn.emailjs.com/sdk/3.2.0/email.min.js';
        emailjsScript.onload = () => {
            emailjs.init(EMAILJS_USER_ID);
        };
        document.head.appendChild(emailjsScript);

        // Form submission
        document.getElementById('orderForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Validate that at least one product is selected
            const hasProducts = Object.values(quantities).some(qty => qty > 0);
            if (!hasProducts) {
                alert('Seleziona almeno un prodotto per continuare.');
                return;
            }

            // Show loading state
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-3"></i>Invio in corso...';
            submitBtn.disabled = true;

            // Prepare email parameters
            const formData = new FormData(e.target);
            const orderData = {
                products: quantities,
                total: Object.keys(quantities).reduce((sum, product) => 
                    sum + (quantities[product] * prices[product]), 0),
                personalData: Object.fromEntries(formData)
            };

            const emailParams = {
                to_name: formData.get('nome') + ' ' + formData.get('cognome'),
                to_email: formData.get('email'),
                phone: formData.get('telefono'),
                address: formData.get('indirizzo') + ', ' + formData.get('cap') + ', ' + formData.get('citta') + ', ' + formData.get('provincia'),
                notes: formData.get('note'),
                order_details: JSON.stringify(orderData, null, 2),
                total_price: `€${orderData.total.toFixed(2)}`
            };

            // Send email using EmailJS
            emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, emailParams)
                .then(() => {
                    // Hide form and show success message
                    document.getElementById('orderForm').style.display = 'none';
                    document.getElementById('successMessage').style.display = 'block';
                    
                    // Scroll to top
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }, (error) => {
                    alert('Errore nell\'invio dell\'ordine. Riprova più tardi.');
                    console.error('EmailJS error:', error);
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                });
        });

        // Back button functionality
        function goBack() {
            window.history.back();
        }

        // Initialize form
        document.addEventListener('DOMContentLoaded', function() {
            // Set initial state
            updateOrderSummary();

            // Check URL query parameter for product pre-selection
            const urlParams = new URLSearchParams(window.location.search);
            const preselectProduct = urlParams.get('product');
            if (preselectProduct && quantities.hasOwnProperty(preselectProduct)) {
                quantities[preselectProduct] = 1;
                updateQuantityDisplay(preselectProduct);
                updateProductCard(preselectProduct);
                updateOrderSummary();
            }
            
            // Add smooth scrolling for internal links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });

            // Add input validation
            const inputs = document.querySelectorAll('.form-input');
            inputs.forEach(input => {
                input.addEventListener('blur', function() {
                    validateInput(this);
                });
            });
        });

        function validateInput(input) {
            const value = input.value.trim();
            const type = input.type;
            
            // Remove previous error styling
            input.classList.remove('border-red-500');
            
            // Basic validation
            if (input.required && !value) {
                input.classList.add('border-red-500');
                return false;
            }
            
            // Email validation
            if (type === 'email' && value) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(value)) {
                    input.classList.add('border-red-500');
                    return false;
                }
            }
            
            // Phone validation (Italian format)
            if (type === 'tel' && value) {
                const phoneRegex = /^[\+]?[0-9\s\-\(\)]{8,}$/;
                if (!phoneRegex.test(value)) {
                    input.classList.add('border-red-500');
                    return false;
                }
            }
            
            // CAP validation (Italian postal code)
            if (input.id === 'cap' && value) {
                const capRegex = /^[0-9]{5}$/;
                if (!capRegex.test(value)) {
                    input.classList.add('border-red-500');
                    return false;
                }
            }
            
            return true;
        }

        // Add loading animation to buttons
        document.querySelectorAll('.quantity-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                this.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    this.style.transform = '';
                }, 150);
            });
        });

        // Keyboard navigation for quantity selectors
        document.addEventListener('keydown', function(e) {
            if (e.target.classList.contains('quantity-display')) {
                const product = e.target.id.replace('quantity-', '');
                
                if (e.key === 'ArrowUp' || e.key === '+') {
                    e.preventDefault();
                    increaseQuantity(product);
                } else if (e.key === 'ArrowDown' || e.key === '-') {
                    e.preventDefault();
                    decreaseQuantity(product);
                }
            }
        });

        // Auto-save to localStorage (if needed for persistence)
        function saveToStorage() {
            const formData = new FormData(document.getElementById('orderForm'));
            const data = {
                quantities: quantities,
                formData: Object.fromEntries(formData)
            };
            // Note: localStorage is not used due to artifact restrictions
            // This is where you would implement storage if needed
        }

        // Add responsive behavior
        window.addEventListener('resize', function() {
            // Adjust layout for mobile devices
            const isMobile = window.innerWidth < 768;
            const productCards = document.querySelectorAll('.product-card');
            
            productCards.forEach(card => {
                if (isMobile) {
                    card.classList.add('text-center');
                } else {
                    card.classList.remove('text-center');
                }
            });
        });

        // Initialize on load
        window.addEventListener('load', function() {
            // Add entrance animations
            const elements = document.querySelectorAll('.animate-fade-in, .animate-slide-in');
            elements.forEach((el, index) => {
                setTimeout(() => {
                    el.style.opacity = '1';
                    el.style.transform = 'translateY(0)';
                }, index * 200);
            });
        });
    </script>
</body>
</html> 